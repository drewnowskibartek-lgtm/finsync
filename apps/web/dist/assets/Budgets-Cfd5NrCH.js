import{r as n,u as z,j as e,B as S,T as s,C as y,b as v,c,d as B,S as f,h as u}from"./index-BWONGnEN.js";import{u as R}from"./useSubscription-ClKgoe6k.js";import{G as o}from"./Grid-BBssZsKo.js";import{M as I}from"./MenuItem-DJikRv8z.js";import{C as N,L as W}from"./LinearProgress-B2NhPfo-.js";const A=()=>{const[x,h]=n.useState([]),[k,g]=n.useState([]),[p,m]=n.useState([]),[i,l]=n.useState({kategoriaId:"",rok:new Date().getFullYear(),miesiac:new Date().getMonth()+1,kwota:0}),{data:d}=R(),{user:b}=z(),j=async()=>{try{const a=await u.get("/budgets");h(a.data);const t=await u.get("/categories");if(g(t.data),d?.plan==="PRO"){const r=await u.get("/reports/advanced");m(r.data.budzety??[])}else m([])}catch{h([]),g([]),m([])}};n.useEffect(()=>{j()},[d?.plan]);const C=async()=>{await u.post("/budgets",i),j()},w=b?.rola==="ADMIN"||b?.rola==="USER",M=n.useMemo(()=>{const a=new Map;for(const t of p)a.set(t.id,t);return a},[p]),P=a=>a>=100?"error.main":a>=80?"warning.main":"primary.main";return e.jsxs(S,{children:[e.jsx(s,{variant:"h2",mb:2,children:"Budżety"}),e.jsx(y,{sx:{mb:2},children:e.jsxs(v,{children:[e.jsxs(o,{container:!0,spacing:2,children:[e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(c,{select:!0,label:"Kategoria",fullWidth:!0,value:i.kategoriaId,onChange:a=>l(t=>({...t,kategoriaId:a.target.value})),children:k.map(a=>e.jsxs(I,{value:a.id,children:[a.nazwa," ",a.globalna?"(globalna)":""]},a.id))})}),e.jsx(o,{item:!0,xs:6,md:2,children:e.jsx(c,{label:"Rok",type:"number",fullWidth:!0,value:i.rok,onChange:a=>l(t=>({...t,rok:Number(a.target.value)}))})}),e.jsx(o,{item:!0,xs:6,md:2,children:e.jsx(c,{label:"Miesiąc",type:"number",fullWidth:!0,value:i.miesiac,onChange:a=>l(t=>({...t,miesiac:Number(a.target.value)}))})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(c,{label:"Kwota",type:"number",fullWidth:!0,value:i.kwota,onChange:a=>l(t=>({...t,kwota:Number(a.target.value)}))})}),e.jsx(o,{item:!0,xs:12,md:2,children:e.jsx(B,{variant:"contained",fullWidth:!0,onClick:C,sx:{height:"100%"},disabled:!w,children:"Dodaj"})})]}),d?.plan!=="PRO"&&e.jsx(s,{variant:"body2",color:"text.secondary",mt:1,children:"Zaawansowane wykorzystanie budżetu jest dostępne w planie Pro."}),!w&&e.jsx(s,{variant:"body2",color:"text.secondary",mt:1,children:"Konto Viewer nie może dodawać budżetów."})]})}),e.jsxs(f,{spacing:1,children:[x.map(a=>{const t=M.get(a.id),r=t?.procent??0;return e.jsx(y,{children:e.jsxs(v,{children:[e.jsxs(f,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(s,{variant:"body1",children:[a.kategoria?.nazwa," — ",a.rok,"/",a.miesiac," — ",a.kwota," PLN"]}),d?.plan==="PRO"&&e.jsx(N,{size:"small",label:`${r}%`,color:r>=100?"error":r>=80?"warning":"primary",variant:"outlined"})]}),d?.plan==="PRO"&&e.jsxs(e.Fragment,{children:[e.jsxs(s,{variant:"body2",color:"text.secondary",children:["Wydano: ",t?.wydano??0," PLN (",r,"%)"]}),e.jsx(W,{variant:"determinate",value:Math.min(100,r),sx:{mt:1,height:8,bgcolor:"#eceff1","& .MuiLinearProgress-bar":{bgcolor:P(r)}}}),r>=100&&e.jsx(s,{variant:"body2",color:"error",mt:1,children:"Przekroczono budżet."}),r>=80&&r<100&&e.jsx(s,{variant:"body2",color:"warning.main",mt:1,children:"Zbliżasz się do limitu budżetu (≥80%)."})]})]})},a.id)}),x.length===0&&e.jsx(s,{variant:"body2",color:"text.secondary",children:"Brak budżetów. Dodaj pierwszy budżet powyżej."})]})]})};export{A as Budgets};
