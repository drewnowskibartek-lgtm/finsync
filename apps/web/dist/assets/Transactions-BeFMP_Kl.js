import{g as Te,r as X,u as ze,j as i,B as Ie,T as Z,C as we,b as ve,c as M,d as oe,S as De,h as pe}from"./index-BWONGnEN.js";import{u as Ae}from"./useSubscription-ClKgoe6k.js";import{u as We,t as Fe,o as Me,s as le,c as Pe}from"./zod-BrYbFVtE.js";import{G as O}from"./Grid-BBssZsKo.js";import{M as H}from"./MenuItem-DJikRv8z.js";import{D as Ue}from"./DataGrid-DTzFwfqR.js";import"./index-BRuYprat.js";import"./LinearProgress-B2NhPfo-.js";var je={exports:{}};var Ne=je.exports,Le;function Ke(){return Le||(Le=1,(function(xe,Ee){((N,_)=>{xe.exports=_()})(Ne,function N(){var _=typeof self<"u"?self:typeof window<"u"?window:_!==void 0?_:{},ne,Y=!_.document&&!!_.postMessage,ee=_.IS_PAPA_WORKER||!1,de={},ke=0,u={};function K(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(t){var a=B(t);a.chunkSize=parseInt(a.chunkSize),t.step||t.chunk||(a.chunkSize=null),this._handle=new _e(a),(this._handle.streamer=this)._config=a}).call(this,e),this.parseChunk=function(t,a){var n=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<n){let r=this._config.newline;r||(s=this._config.quoteChar||'"',r=this._handle.guessLineEndings(t,s)),t=[...t.split(r).slice(n)].join(r)}this.isFirstChunk&&y(this._config.beforeFirstChunk)&&(s=this._config.beforeFirstChunk(t))!==void 0&&(t=s),this.isFirstChunk=!1,this._halted=!1;var n=this._partialLine+t,s=(this._partialLine="",this._handle.parse(n,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(t=s.meta.cursor,n=(this._finished||(this._partialLine=n.substring(t-this._baseIndex),this._baseIndex=t),s&&s.data&&(this._rowCount+=s.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),ee)_.postMessage({results:s,workerId:u.WORKER_ID,finished:n});else if(y(this._config.chunk)&&!a){if(this._config.chunk(s,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=s=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(s.data),this._completeResults.errors=this._completeResults.errors.concat(s.errors),this._completeResults.meta=s.meta),this._completed||!n||!y(this._config.complete)||s&&s.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),n||s&&s.meta.paused||this._nextChunk(),s}this._halted=!0},this._sendError=function(t){y(this._config.error)?this._config.error(t):ee&&this._config.error&&_.postMessage({workerId:u.WORKER_ID,error:t,finished:!1})}}function ue(e){var t;(e=e||{}).chunkSize||(e.chunkSize=u.RemoteChunkSize),K.call(this,e),this._nextChunk=Y?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(a){this._input=a,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),Y||(t.onload=U(this._chunkLoaded,this),t.onerror=U(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!Y),this._config.downloadRequestHeaders){var a,n=this._config.downloadRequestHeaders;for(a in n)t.setRequestHeader(a,n[a])}var s;this._config.chunkSize&&(s=this._start+this._config.chunkSize-1,t.setRequestHeader("Range","bytes="+this._start+"-"+s));try{t.send(this._config.downloadRequestBody)}catch(r){this._chunkError(r.message)}Y&&t.status===0&&this._chunkError()}},this._chunkLoaded=function(){t.readyState===4&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize||t.responseText.length,this._finished=!this._config.chunkSize||this._start>=(a=>(a=a.getResponseHeader("Content-Range"))!==null?parseInt(a.substring(a.lastIndexOf("/")+1)):-1)(t),this.parseChunk(t.responseText)))},this._chunkError=function(a){a=t.statusText||a,this._sendError(new Error(a))}}function se(e){(e=e||{}).chunkSize||(e.chunkSize=u.LocalChunkSize),K.call(this,e);var t,a,n=typeof FileReader<"u";this.stream=function(s){this._input=s,a=s.slice||s.webkitSlice||s.mozSlice,n?((t=new FileReader).onload=U(this._chunkLoaded,this),t.onerror=U(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var s=this._input,r=(this._config.chunkSize&&(r=Math.min(this._start+this._config.chunkSize,this._input.size),s=a.call(s,this._start,r)),t.readAsText(s,this._config.encoding));n||this._chunkLoaded({target:{result:r}})},this._chunkLoaded=function(s){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(s.target.result)},this._chunkError=function(){this._sendError(t.error)}}function ae(e){var t;K.call(this,e=e||{}),this.stream=function(a){return t=a,this._nextChunk()},this._nextChunk=function(){var a,n;if(!this._finished)return a=this._config.chunkSize,t=a?(n=t.substring(0,a),t.substring(a)):(n=t,""),this._finished=!t,this.parseChunk(n)}}function z(e){K.call(this,e=e||{});var t=[],a=!0,n=!1;this.pause=function(){K.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){K.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(s){this._input=s,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){n&&t.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):a=!0},this._streamData=U(function(s){try{t.push(typeof s=="string"?s:s.toString(this._config.encoding)),a&&(a=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(r){this._streamError(r)}},this),this._streamError=U(function(s){this._streamCleanUp(),this._sendError(s)},this),this._streamEnd=U(function(){this._streamCleanUp(),n=!0,this._streamData("")},this),this._streamCleanUp=U(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function _e(e){var t,a,n,s,r=Math.pow(2,53),o=-r,b=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,A=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,c=this,w=0,d=0,E=!1,f=!1,g=[],l={data:[],errors:[],meta:{}};function D(m){return e.skipEmptyLines==="greedy"?m.join("").trim()==="":m.length===1&&m[0].length===0}function I(){if(l&&n&&(q("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+u.DefaultDelimiter+"'"),n=!1),e.skipEmptyLines&&(l.data=l.data.filter(function(h){return!D(h)})),W()){let h=function(C,L){y(e.transformHeader)&&(C=e.transformHeader(C,L)),g.push(C)};if(l)if(Array.isArray(l.data[0])){for(var m=0;W()&&m<l.data.length;m++)l.data[m].forEach(h);l.data.splice(0,1)}else l.data.forEach(h)}function k(h,C){for(var L=e.header?{}:[],v=0;v<h.length;v++){var j=v,x=h[v],x=((G,p)=>(R=>(e.dynamicTypingFunction&&e.dynamicTyping[R]===void 0&&(e.dynamicTyping[R]=e.dynamicTypingFunction(R)),(e.dynamicTyping[R]||e.dynamicTyping)===!0))(G)?p==="true"||p==="TRUE"||p!=="false"&&p!=="FALSE"&&((R=>{if(b.test(R)&&(R=parseFloat(R),o<R&&R<r))return 1})(p)?parseFloat(p):A.test(p)?new Date(p):p===""?null:p):p)(j=e.header?v>=g.length?"__parsed_extra":g[v]:j,x=e.transform?e.transform(x,j):x);j==="__parsed_extra"?(L[j]=L[j]||[],L[j].push(x)):L[j]=x}return e.header&&(v>g.length?q("FieldMismatch","TooManyFields","Too many fields: expected "+g.length+" fields but parsed "+v,d+C):v<g.length&&q("FieldMismatch","TooFewFields","Too few fields: expected "+g.length+" fields but parsed "+v,d+C)),L}var S;l&&(e.header||e.dynamicTyping||e.transform)&&(S=1,!l.data.length||Array.isArray(l.data[0])?(l.data=l.data.map(k),S=l.data.length):l.data=k(l.data,0),e.header&&l.meta&&(l.meta.fields=g),d+=S)}function W(){return e.header&&g.length===0}function q(m,k,S,h){m={type:m,code:k,message:S},h!==void 0&&(m.row=h),l.errors.push(m)}y(e.step)&&(s=e.step,e.step=function(m){l=m,W()?I():(I(),l.data.length!==0&&(w+=m.data.length,e.preview&&w>e.preview?a.abort():(l.data=l.data[0],s(l,c))))}),this.parse=function(m,k,S){var h=e.quoteChar||'"',h=(e.newline||(e.newline=this.guessLineEndings(m,h)),n=!1,e.delimiter?y(e.delimiter)&&(e.delimiter=e.delimiter(m),l.meta.delimiter=e.delimiter):((h=((C,L,v,j,x)=>{var G,p,R,ie;x=x||[",","	","|",";",u.RECORD_SEP,u.UNIT_SEP];for(var ce=0;ce<x.length;ce++){for(var Q,ge=x[ce],F=0,V=0,T=0,P=(R=void 0,new he({comments:j,delimiter:ge,newline:L,preview:10}).parse(C)),re=0;re<P.data.length;re++)v&&D(P.data[re])?T++:(Q=P.data[re].length,V+=Q,R===void 0?R=Q:0<Q&&(F+=Math.abs(Q-R),R=Q));0<P.data.length&&(V/=P.data.length-T),(p===void 0||F<=p)&&(ie===void 0||ie<V)&&1.99<V&&(p=F,G=ge,ie=V)}return{successful:!!(e.delimiter=G),bestDelimiter:G}})(m,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess)).successful?e.delimiter=h.bestDelimiter:(n=!0,e.delimiter=u.DefaultDelimiter),l.meta.delimiter=e.delimiter),B(e));return e.preview&&e.header&&h.preview++,t=m,a=new he(h),l=a.parse(t,k,S),I(),E?{meta:{paused:!0}}:l||{meta:{paused:!1}}},this.paused=function(){return E},this.pause=function(){E=!0,a.abort(),t=y(e.chunk)?"":t.substring(a.getCharIndex())},this.resume=function(){c.streamer._halted?(E=!1,c.streamer.parseChunk(t,!0)):setTimeout(c.resume,3)},this.aborted=function(){return f},this.abort=function(){f=!0,a.abort(),l.meta.aborted=!0,y(e.complete)&&e.complete(l),t=""},this.guessLineEndings=function(C,h){C=C.substring(0,1048576);var h=new RegExp($(h)+"([^]*?)"+$(h),"gm"),S=(C=C.replace(h,"")).split("\r"),h=C.split(`
`),C=1<h.length&&h[0].length<S[0].length;if(S.length===1||C)return`
`;for(var L=0,v=0;v<S.length;v++)S[v][0]===`
`&&L++;return L>=S.length/2?`\r
`:"\r"}}function $(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function he(e){var t=(e=e||{}).delimiter,a=e.newline,n=e.comments,s=e.step,r=e.preview,o=e.fastMode,b=null,A=!1,c=e.quoteChar==null?'"':e.quoteChar,w=c;if(e.escapeChar!==void 0&&(w=e.escapeChar),(typeof t!="string"||-1<u.BAD_DELIMITERS.indexOf(t))&&(t=","),n===t)throw new Error("Comment character same as delimiter");n===!0?n="#":(typeof n!="string"||-1<u.BAD_DELIMITERS.indexOf(n))&&(n=!1),a!==`
`&&a!=="\r"&&a!==`\r
`&&(a=`
`);var d=0,E=!1;this.parse=function(f,g,l){if(typeof f!="string")throw new Error("Input must be a string");var D=f.length,I=t.length,W=a.length,q=n.length,m=y(s),k=[],S=[],h=[],C=d=0;if(!f)return F();if(o||o!==!1&&f.indexOf(c)===-1){for(var L=f.split(a),v=0;v<L.length;v++){if(h=L[v],d+=h.length,v!==L.length-1)d+=a.length;else if(l)return F();if(!n||h.substring(0,q)!==n){if(m){if(k=[],ie(h.split(t)),V(),E)return F()}else ie(h.split(t));if(r&&r<=v)return k=k.slice(0,r),F(!0)}}return F()}for(var j=f.indexOf(t,d),x=f.indexOf(a,d),G=new RegExp($(w)+$(c),"g"),p=f.indexOf(c,d);;)if(f[d]===c)for(p=d,d++;;){if((p=f.indexOf(c,p+1))===-1)return l||S.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:k.length,index:d}),Q();if(p===D-1)return Q(f.substring(d,p).replace(G,c));if(c===w&&f[p+1]===w)p++;else if(c===w||p===0||f[p-1]!==w){j!==-1&&j<p+1&&(j=f.indexOf(t,p+1));var R=ce((x=x!==-1&&x<p+1?f.indexOf(a,p+1):x)===-1?j:Math.min(j,x));if(f.substr(p+1+R,I)===t){h.push(f.substring(d,p).replace(G,c)),f[d=p+1+R+I]!==c&&(p=f.indexOf(c,d)),j=f.indexOf(t,d),x=f.indexOf(a,d);break}if(R=ce(x),f.substring(p+1+R,p+1+R+W)===a){if(h.push(f.substring(d,p).replace(G,c)),ge(p+1+R+W),j=f.indexOf(t,d),p=f.indexOf(c,d),m&&(V(),E))return F();if(r&&k.length>=r)return F(!0);break}S.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:k.length,index:d}),p++}}else if(n&&h.length===0&&f.substring(d,d+q)===n){if(x===-1)return F();d=x+W,x=f.indexOf(a,d),j=f.indexOf(t,d)}else if(j!==-1&&(j<x||x===-1))h.push(f.substring(d,j)),d=j+I,j=f.indexOf(t,d);else{if(x===-1)break;if(h.push(f.substring(d,x)),ge(x+W),m&&(V(),E))return F();if(r&&k.length>=r)return F(!0)}return Q();function ie(T){k.push(T),C=d}function ce(T){var P=0;return P=T!==-1&&(T=f.substring(p+1,T))&&T.trim()===""?T.length:P}function Q(T){return l||(T===void 0&&(T=f.substring(d)),h.push(T),d=D,ie(h),m&&V()),F()}function ge(T){d=T,ie(h),h=[],x=f.indexOf(a,d)}function F(T){if(e.header&&!g&&k.length&&!A){var P=k[0],re=Object.create(null),Re=new Set(P);let Ce=!1;for(let fe=0;fe<P.length;fe++){let J=P[fe];if(re[J=y(e.transformHeader)?e.transformHeader(J,fe):J]){let me,Oe=re[J];for(;me=J+"_"+Oe,Oe++,Re.has(me););Re.add(me),P[fe]=me,re[J]++,Ce=!0,(b=b===null?{}:b)[me]=J}else re[J]=1,P[fe]=J;Re.add(J)}Ce&&console.warn("Duplicate headers found and renamed."),A=!0}return{data:k,errors:S,meta:{delimiter:t,linebreak:a,aborted:E,truncated:!!T,cursor:C+(g||0),renamedHeaders:b}}}function V(){s(F()),k=[],S=[]}},this.abort=function(){E=!0},this.getCharIndex=function(){return d}}function te(e){var t=e.data,a=de[t.workerId],n=!1;if(t.error)a.userError(t.error,t.file);else if(t.results&&t.results.data){var s={abort:function(){n=!0,be(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:ye,resume:ye};if(y(a.userStep)){for(var r=0;r<t.results.data.length&&(a.userStep({data:t.results.data[r],errors:t.results.errors,meta:t.results.meta},s),!n);r++);delete t.results}else y(a.userChunk)&&(a.userChunk(t.results,s,t.file),delete t.results)}t.finished&&!n&&be(t.workerId,t.results)}function be(e,t){var a=de[e];y(a.userComplete)&&a.userComplete(t),a.terminate(),delete de[e]}function ye(){throw new Error("Not implemented.")}function B(e){if(typeof e!="object"||e===null)return e;var t,a=Array.isArray(e)?[]:{};for(t in e)a[t]=B(e[t]);return a}function U(e,t){return function(){e.apply(t,arguments)}}function y(e){return typeof e=="function"}return u.parse=function(e,t){var a=(t=t||{}).dynamicTyping||!1;if(y(a)&&(t.dynamicTypingFunction=a,a={}),t.dynamicTyping=a,t.transform=!!y(t.transform)&&t.transform,!t.worker||!u.WORKERS_SUPPORTED)return a=null,u.NODE_STREAM_INPUT,typeof e=="string"?(e=(n=>n.charCodeAt(0)!==65279?n:n.slice(1))(e),a=new(t.download?ue:ae)(t)):e.readable===!0&&y(e.read)&&y(e.on)?a=new z(t):(_.File&&e instanceof File||e instanceof Object)&&(a=new se(t)),a.stream(e);(a=(()=>{var n;return!!u.WORKERS_SUPPORTED&&(n=(()=>{var s=_.URL||_.webkitURL||null,r=N.toString();return u.BLOB_URL||(u.BLOB_URL=s.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",r,")();"],{type:"text/javascript"})))})(),(n=new _.Worker(n)).onmessage=te,n.id=ke++,de[n.id]=n)})()).userStep=t.step,a.userChunk=t.chunk,a.userComplete=t.complete,a.userError=t.error,t.step=y(t.step),t.chunk=y(t.chunk),t.complete=y(t.complete),t.error=y(t.error),delete t.worker,a.postMessage({input:e,config:t,workerId:a.id})},u.unparse=function(e,t){var a=!1,n=!0,s=",",r=`\r
`,o='"',b=o+o,A=!1,c=null,w=!1,d=((()=>{if(typeof t=="object"){if(typeof t.delimiter!="string"||u.BAD_DELIMITERS.filter(function(g){return t.delimiter.indexOf(g)!==-1}).length||(s=t.delimiter),typeof t.quotes!="boolean"&&typeof t.quotes!="function"&&!Array.isArray(t.quotes)||(a=t.quotes),typeof t.skipEmptyLines!="boolean"&&typeof t.skipEmptyLines!="string"||(A=t.skipEmptyLines),typeof t.newline=="string"&&(r=t.newline),typeof t.quoteChar=="string"&&(o=t.quoteChar),typeof t.header=="boolean"&&(n=t.header),Array.isArray(t.columns)){if(t.columns.length===0)throw new Error("Option columns is empty");c=t.columns}t.escapeChar!==void 0&&(b=t.escapeChar+o),t.escapeFormulae instanceof RegExp?w=t.escapeFormulae:typeof t.escapeFormulae=="boolean"&&t.escapeFormulae&&(w=/^[=+\-@\t\r].*$/)}})(),new RegExp($(o),"g"));if(typeof e=="string"&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return E(null,e,A);if(typeof e[0]=="object")return E(c||Object.keys(e[0]),e,A)}else if(typeof e=="object")return typeof e.data=="string"&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||c),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:typeof e.data[0]=="object"?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||typeof e.data[0]=="object"||(e.data=[e.data])),E(e.fields||[],e.data||[],A);throw new Error("Unable to serialize unrecognized input");function E(g,l,D){var I="",W=(typeof g=="string"&&(g=JSON.parse(g)),typeof l=="string"&&(l=JSON.parse(l)),Array.isArray(g)&&0<g.length),q=!Array.isArray(l[0]);if(W&&n){for(var m=0;m<g.length;m++)0<m&&(I+=s),I+=f(g[m],m);0<l.length&&(I+=r)}for(var k=0;k<l.length;k++){var S=(W?g:l[k]).length,h=!1,C=W?Object.keys(l[k]).length===0:l[k].length===0;if(D&&!W&&(h=D==="greedy"?l[k].join("").trim()==="":l[k].length===1&&l[k][0].length===0),D==="greedy"&&W){for(var L=[],v=0;v<S;v++){var j=q?g[v]:v;L.push(l[k][j])}h=L.join("").trim()===""}if(!h){for(var x=0;x<S;x++){0<x&&!C&&(I+=s);var G=W&&q?g[x]:x;I+=f(l[k][G],x)}k<l.length-1&&(!D||0<S&&!C)&&(I+=r)}}return I}function f(g,l){var D,I;return g==null?"":g.constructor===Date?JSON.stringify(g).slice(1,25):(I=!1,w&&typeof g=="string"&&w.test(g)&&(g="'"+g,I=!0),D=g.toString().replace(d,b),(I=I||a===!0||typeof a=="function"&&a(g,l)||Array.isArray(a)&&a[l]||((W,q)=>{for(var m=0;m<q.length;m++)if(-1<W.indexOf(q[m]))return!0;return!1})(D,u.BAD_DELIMITERS)||-1<D.indexOf(s)||D.charAt(0)===" "||D.charAt(D.length-1)===" ")?o+D+o:D)}},u.RECORD_SEP="",u.UNIT_SEP="",u.BYTE_ORDER_MARK="\uFEFF",u.BAD_DELIMITERS=["\r",`
`,'"',u.BYTE_ORDER_MARK],u.WORKERS_SUPPORTED=!Y&&!!_.Worker,u.NODE_STREAM_INPUT=1,u.LocalChunkSize=10485760,u.RemoteChunkSize=5242880,u.DefaultDelimiter=",",u.Parser=he,u.ParserHandle=_e,u.NetworkStreamer=ue,u.FileStreamer=se,u.StringStreamer=ae,u.ReadableStreamStreamer=z,_.jQuery&&((ne=_.jQuery).fn.parse=function(e){var t=e.config||{},a=[];return this.each(function(r){if(!(ne(this).prop("tagName").toUpperCase()==="INPUT"&&ne(this).attr("type").toLowerCase()==="file"&&_.FileReader)||!this.files||this.files.length===0)return!0;for(var o=0;o<this.files.length;o++)a.push({file:this.files[o],inputElem:this,instanceConfig:ne.extend({},t)})}),n(),this;function n(){if(a.length===0)y(e.complete)&&e.complete();else{var r,o,b,A,c=a[0];if(y(e.before)){var w=e.before(c.file,c.inputElem);if(typeof w=="object"){if(w.action==="abort")return r="AbortError",o=c.file,b=c.inputElem,A=w.reason,void(y(e.error)&&e.error({name:r},o,b,A));if(w.action==="skip")return void s();typeof w.config=="object"&&(c.instanceConfig=ne.extend(c.instanceConfig,w.config))}else if(w==="skip")return void s()}var d=c.instanceConfig.complete;c.instanceConfig.complete=function(E){y(d)&&d(E,c.file,c.inputElem),s()},u.parse(c.file,c.instanceConfig)}}function s(){a.splice(0,1),n()}}),ee&&(_.onmessage=function(e){e=e.data,u.WORKER_ID===void 0&&e&&(u.WORKER_ID=e.workerId),typeof e.input=="string"?_.postMessage({workerId:u.WORKER_ID,results:u.parse(e.input,e.config),finished:!0}):(_.File&&e.input instanceof File||e.input instanceof Object)&&(e=u.parse(e.input,e.config))&&_.postMessage({workerId:u.WORKER_ID,results:e,finished:!0})}),(ue.prototype=Object.create(K.prototype)).constructor=ue,(se.prototype=Object.create(K.prototype)).constructor=se,(ae.prototype=Object.create(ae.prototype)).constructor=ae,(z.prototype=Object.create(K.prototype)).constructor=z,u})})(je)),je.exports}var Be=Ke();const Se=Te(Be),qe=Me({data:le().min(1,"Data jest wymagana."),kwota:Pe.number().finite("Kwota musi być liczbą."),waluta:le().length(3,"Waluta musi mieć 3 znaki.").default("PLN"),odbiorca:le().min(2,"Odbiorca musi mieć co najmniej 2 znaki."),referencja:le().optional(),kategoriaId:le().optional(),metoda:le().optional(),notatka:le().optional()}),Ye=()=>{const[xe,Ee]=X.useState([]),[N,_]=X.useState({od:"",do:"",kategoriaId:"",kwotaMin:"",kwotaMax:"",szukaj:"",waluta:"",metoda:""}),{data:ne}=Ae(),{user:Y}=ze(),[ee,de]=X.useState(null),[ke,u]=X.useState(null),[K,ue]=X.useState([]),[se,ae]=X.useState([]),[z,_e]=X.useState({data:"",kwota:"",waluta:"",odbiorca:"",referencja:"",kategoria:"",metoda:"",notatka:""}),[$,he]=X.useState([]),{register:te,handleSubmit:be,reset:ye,formState:B}=We({resolver:Fe(qe),defaultValues:{waluta:"PLN",metoda:"karta"}}),U=async()=>{try{const r=await pe.get("/transactions",{params:N});Ee(r.data);const o=await pe.get("/categories");ue(o.data)}catch{Ee([])}};X.useEffect(()=>{U()},[]);const y=async r=>{try{await pe.post("/transactions",r),u(null),ye({waluta:"PLN",metoda:"karta"}),U()}catch(o){u(o?.response?.data?.message??"Nie udało się dodać transakcji.")}},e=X.useMemo(()=>[{field:"data",headerName:"Data",flex:1},{field:"kwota",headerName:"Kwota",flex:1},{field:"waluta",headerName:"Waluta",flex:.7},{field:"odbiorca",headerName:"Odbiorca",flex:1.2},{field:"kategoria",headerName:"Kategoria",flex:1,valueGetter:r=>r.row.kategoria?.nazwa??""},{field:"czyUzgodnione",headerName:"Uzgodnione",flex:.7,renderCell:r=>i.jsx("span",{style:{display:"inline-flex",padding:"2px 8px",borderRadius:999,fontSize:12,fontWeight:600,background:r.row.czyUzgodnione?"#e8f5e9":"#eceff1",color:r.row.czyUzgodnione?"#179d46":"#546e7a"},children:r.row.czyUzgodnione?"Tak":"Nie"})},{field:"flagaDuplikatu",headerName:"Duplikat",flex:.7,renderCell:r=>i.jsx("span",{style:{display:"inline-flex",padding:"2px 8px",borderRadius:999,fontSize:12,fontWeight:600,background:r.row.flagaDuplikatu?"#ffebee":"#eceff1",color:r.row.flagaDuplikatu?"#e53935":"#546e7a"},children:r.row.flagaDuplikatu?"Tak":"Nie"})},{field:"referencja",headerName:"Referencja",flex:1}],[]),t=Y?.rola==="ADMIN"||Y?.rola==="USER",a=Y?.rola!=="VIEWER",n=ne?.plan==="PRO",s=async()=>{if(!ee)return;if(!z.data||!z.kwota||!z.odbiorca){u("Ustaw mapowanie pól: data, kwota, odbiorca.");return}const r=await ee.text(),b=Se.parse(r,{header:!0,skipEmptyLines:!0}).data.map(E=>({data:E[z.data]??"",kwota:E[z.kwota]??"",waluta:E[z.waluta]??"PLN",odbiorca:E[z.odbiorca]??"",referencja:E[z.referencja]??"",kategoria:E[z.kategoria]??"",metoda:E[z.metoda]??"",notatka:E[z.notatka]??""})),A=Se.unparse(b,{quotes:!1}),c=new Blob([A],{type:"text/csv;charset=utf-8"}),w=new FormData;w.append("file",c,"normalized.csv");const d=await pe.post("/transactions/import",w,{headers:{"Content-Type":"multipart/form-data"}});u(`Dodane: ${d.data.dodane}, duplikaty: ${d.data.duplikaty}, błędy: ${d.data.bledy.length}`),he(d.data.bledy??[]),U()};return i.jsxs(Ie,{children:[i.jsx(Z,{variant:"h2",mb:2,children:"Transakcje"}),i.jsx(we,{sx:{mb:2},children:i.jsxs(ve,{children:[i.jsx(Z,{variant:"h3",mb:1,children:"Dodaj transakcję"}),i.jsxs(O,{container:!0,spacing:2,component:"form",onSubmit:be(y),children:[i.jsx(O,{item:!0,xs:12,md:3,children:i.jsx(M,{label:"Data",type:"date",fullWidth:!0,InputLabelProps:{shrink:!0},...te("data"),error:!!B.errors.data,helperText:B.errors.data?.message})}),i.jsx(O,{item:!0,xs:12,md:2,children:i.jsx(M,{label:"Kwota",type:"number",fullWidth:!0,...te("kwota"),error:!!B.errors.kwota,helperText:B.errors.kwota?.message})}),i.jsx(O,{item:!0,xs:12,md:2,children:i.jsx(M,{label:"Waluta",fullWidth:!0,select:!0,...te("waluta"),error:!!B.errors.waluta,helperText:B.errors.waluta?.message,children:["PLN","EUR","USD","GBP"].map(r=>i.jsx(H,{value:r,children:r},r))})}),i.jsx(O,{item:!0,xs:12,md:3,children:i.jsx(M,{label:"Odbiorca",fullWidth:!0,...te("odbiorca"),error:!!B.errors.odbiorca,helperText:B.errors.odbiorca?.message})}),i.jsx(O,{item:!0,xs:12,md:2,children:i.jsx(M,{select:!0,label:"Metoda",fullWidth:!0,...te("metoda"),children:[{id:"karta",label:"Karta"},{id:"przelew",label:"Przelew"},{id:"gotowka",label:"Gotówka"},{id:"blikiem",label:"BLIK"}].map(r=>i.jsx(H,{value:r.id,children:r.label},r.id))})}),i.jsx(O,{item:!0,xs:12,md:2,children:i.jsxs(M,{select:!0,label:"Kategoria",fullWidth:!0,...te("kategoriaId"),children:[i.jsx(H,{value:"",children:"Brak"}),K.map(r=>i.jsxs(H,{value:r.id,children:[r.nazwa," ",r.globalna?"(globalna)":""]},r.id))]})}),i.jsx(O,{item:!0,xs:12,md:2,children:i.jsx(oe,{variant:"contained",type:"submit",fullWidth:!0,disabled:!t,sx:{height:"100%"},children:"Dodaj"})})]}),i.jsx(O,{container:!0,spacing:2,mt:0,children:i.jsx(O,{item:!0,xs:12,children:i.jsx(M,{label:"Notatka",fullWidth:!0,...te("notatka")})})}),!t&&i.jsx(Z,{variant:"body2",color:"text.secondary",mt:1,children:"Konto Viewer nie może dodawać transakcji."})]})}),i.jsx(we,{sx:{mb:2},children:i.jsx(ve,{children:i.jsxs(O,{container:!0,spacing:2,children:[i.jsx(O,{item:!0,xs:12,md:3,children:i.jsx(M,{label:"Data od",type:"date",fullWidth:!0,InputLabelProps:{shrink:!0},value:N.od,onChange:r=>_(o=>({...o,od:r.target.value}))})}),i.jsx(O,{item:!0,xs:12,md:3,children:i.jsx(M,{label:"Data do",type:"date",fullWidth:!0,InputLabelProps:{shrink:!0},value:N.do,onChange:r=>_(o=>({...o,do:r.target.value}))})}),i.jsx(O,{item:!0,xs:12,md:3,children:i.jsxs(M,{select:!0,label:"Kategoria",fullWidth:!0,value:N.kategoriaId,onChange:r=>_(o=>({...o,kategoriaId:r.target.value})),children:[i.jsx(H,{value:"",children:"Wszystkie"}),K.map(r=>i.jsx(H,{value:r.id,children:r.nazwa},r.id))]})}),i.jsx(O,{item:!0,xs:12,md:2,children:i.jsx(M,{label:"Kwota min",type:"number",fullWidth:!0,value:N.kwotaMin,onChange:r=>_(o=>({...o,kwotaMin:r.target.value}))})}),i.jsx(O,{item:!0,xs:12,md:2,children:i.jsx(M,{label:"Kwota max",type:"number",fullWidth:!0,value:N.kwotaMax,onChange:r=>_(o=>({...o,kwotaMax:r.target.value}))})}),i.jsx(O,{item:!0,xs:12,md:2,children:i.jsxs(M,{select:!0,label:"Waluta",fullWidth:!0,value:N.waluta,onChange:r=>_(o=>({...o,waluta:r.target.value})),children:[i.jsx(H,{value:"",children:"Wszystkie"}),["PLN","EUR","USD","GBP"].map(r=>i.jsx(H,{value:r,children:r},r))]})}),i.jsx(O,{item:!0,xs:12,md:2,children:i.jsxs(M,{select:!0,label:"Metoda",fullWidth:!0,value:N.metoda,onChange:r=>_(o=>({...o,metoda:r.target.value})),children:[i.jsx(H,{value:"",children:"Wszystkie"}),[{id:"karta",label:"Karta"},{id:"przelew",label:"Przelew"},{id:"gotowka",label:"Gotówka"},{id:"blikiem",label:"BLIK"}].map(r=>i.jsx(H,{value:r.id,children:r.label},r.id))]})}),i.jsx(O,{item:!0,xs:12,md:2,children:i.jsx(M,{label:"Szukaj",fullWidth:!0,value:N.szukaj,onChange:r=>_(o=>({...o,szukaj:r.target.value}))})}),i.jsx(O,{item:!0,xs:12,md:1,children:i.jsx(oe,{fullWidth:!0,variant:"contained",onClick:U,sx:{height:"100%"},children:"Filtruj"})})]})})}),i.jsxs(De,{direction:"row",spacing:2,mb:2,children:[i.jsx(oe,{variant:"outlined",disabled:!a,onClick:async()=>{const r=await pe.get("/transactions/export",{params:{format:"csv"},responseType:"blob"}),o=URL.createObjectURL(r.data),b=document.createElement("a");b.href=o,b.download="transakcje.csv",b.click(),URL.revokeObjectURL(o)},children:"Eksport CSV"}),i.jsx(oe,{variant:"outlined",disabled:!a,onClick:async()=>{const r=await pe.get("/transactions/export",{params:{format:"xlsx"},responseType:"blob"}),o=URL.createObjectURL(r.data),b=document.createElement("a");b.href=o,b.download="transakcje.xlsx",b.click(),URL.revokeObjectURL(o)},children:"Eksport XLSX"}),i.jsx(oe,{variant:"outlined",disabled:!n||!t,children:"Import CSV (Pro)"})]}),n&&t&&i.jsx(we,{sx:{mb:2},children:i.jsxs(ve,{children:[i.jsx(Z,{variant:"h3",mb:1,children:"Import CSV (Pro)"}),i.jsxs(De,{direction:"row",spacing:2,alignItems:"center",children:[i.jsxs(oe,{variant:"outlined",component:"label",children:["Wybierz plik CSV",i.jsx("input",{type:"file",hidden:!0,accept:".csv",onChange:async r=>{const o=r.target.files?.[0]??null;if(de(o),he([]),o){const b=await o.text(),c=Se.parse(b,{preview:1}).data?.[0]??[];ae(c.filter(w=>!!w))}else ae([])}})]}),i.jsx(Z,{variant:"body2",children:ee?ee.name:"Nie wybrano pliku"}),i.jsx(oe,{variant:"contained",onClick:s,disabled:!ee,children:"Importuj"})]}),se.length>0&&i.jsx(O,{container:!0,spacing:2,mt:1,children:[["data","Data"],["kwota","Kwota"],["waluta","Waluta"],["odbiorca","Odbiorca"],["referencja","Referencja"],["kategoria","Kategoria"],["metoda","Metoda"],["notatka","Notatka"]].map(([r,o])=>i.jsx(O,{item:!0,xs:12,md:3,children:i.jsxs(M,{select:!0,label:`Mapowanie: ${o}`,fullWidth:!0,value:z[r],onChange:b=>_e(A=>({...A,[r]:b.target.value})),children:[i.jsx(H,{value:"",children:"Brak"}),se.map(b=>i.jsx(H,{value:b,children:b},b))]})},r))}),ke&&i.jsx(Z,{variant:"body2",color:"text.secondary",mt:1,children:ke}),$.length>0&&i.jsxs(Ie,{mt:2,children:[i.jsx(Z,{variant:"body2",color:"error",children:"Błędy importu:"}),$.slice(0,10).map((r,o)=>i.jsxs(Z,{variant:"body2",color:"text.secondary",children:["Wiersz ",r.wiersz,": ",r.blad]},o)),$.length>10&&i.jsxs(Z,{variant:"body2",color:"text.secondary",children:["... i ",$.length-10," kolejnych błędów."]})]})]})}),i.jsx(we,{children:i.jsxs(ve,{children:[i.jsx("div",{style:{height:520,width:"100%"},children:i.jsx(Ue,{rows:xe,columns:e,pageSizeOptions:[10,25,50],sx:{border:"none","& .MuiDataGrid-columnHeaders":{background:"rgba(10,37,64,0.04)",color:"#0a2540",fontWeight:700},"& .MuiDataGrid-row:hover":{background:"rgba(46,214,161,0.06)"}}})}),xe.length===0&&i.jsx(Z,{variant:"body2",color:"text.secondary",mt:2,children:"Brak transakcji do wyświetlenia."})]})})]})};export{Ye as Transactions};
